##非中断（正常）模式下的调试

&emsp;&emsp;本书经常使用的一个命令是 `Console.WriteLine()` 函数，它可以把文本输出到控制台。在开发应用程序时，这个函数可以方便地获得操作的额外反馈，例如：

```javascript
        Console.WriteLine("MyFunc() Function about to be called");
        MyFunc("Do something.");
        Console.WriteLine("MyFunc() Function execution completed.");
```

&emsp;&emsp;这段代码说明了如何获取 `MyFunc()` 函数的额外信息。这么做完全正确，但控制台的输出结果会比较混乱。在开发其他类型的应用程序时，如桌面应用程序，没有用于输出信息的控制台。作为一种替代方法，可将文本输出到另一个位置上--IDE中的 `输出` 窗口。

&emsp;&emsp;第 2 章简要介绍了 `错误列表` 窗口，提到其他窗口也可以显示在这个位置上。其中一个窗口就是 `输出` 窗口，在调试时这个窗口非常有用。要显示这个窗口，可以选择 `视图（V） | 输出（O）`。在这个窗口中，可以查看与代码的编译和执行相关的信息，包括在编译过程中遇到的错误等，还可以将自定义的诊断信息直接写到这个窗口中。该窗口 `如图 7-1 所示`。

![图7-1](/assets/7-1.png)

**`图7-1`**

>&emsp;&emsp;**使用 `输出` 窗口的下拉菜单可以选择三种模式：`生成`、`生成顺序` 和 `调试`。分别显示编译和运行期间的信息。本书提到的 “写入 `输出` 窗口”时，实际上是指 “写入 `输出` 窗口的 `调试` 模式视图”。 **

&emsp;&emsp;另外，还可以创建一个日志文件，在运行应用程序时，会把信息添加到该日志文件中。把信息写入日志文件所用的技巧与把文本写到 `输出` 窗口上所用的技巧相同，但需要理解如何从 C#应用程序中访问文件系统。我们把这个功能放在后面的章节中加以讨论，因为目前不必了解文件访问技巧也可以完成许多工作。

###&emsp;&emsp; 1. 输出调试信息

&emsp;&emsp;在运行期间把文本写入 “输出” 窗口是非常简单的。只要用需要的调用替换 `Console.WriteLine()` 调用，就可以把文本写到希望的地方。此时可以使用如下两个命令：

####&emsp;&emsp; ● Debug.WriteLine()
####&emsp;&emsp; ● Trace.WriteLine()

&emsp;&emsp;这两个命令函数的用法几乎完全相同，但有一个重要区别：第一个命令仅在调试模式下运行，而第二个命令还可以用于发布程序。实际上，`Debug.WriteLine()` 命令甚至不能编译到可发布的程序中，在发布版本中，该命令会消失，这肯定有其优点（编译好的代码文件比较小）。实际上，一个源文件可以创建出两个版本的应用程序。调试版本显示所有的额外诊断信息，而发布版本没有这个开销，也不向用户显示可能导致它们反感的消息。

&emsp;&emsp;这两个函数的用法与 `Console.WriteLine()` 是不同的。其唯一的字符串参数用于输出消息，而不需要使用 `{X}` 语法插入变量值。这意味着必须使用 `+` 串联运算符等方式在字符串中插入变量值。它们还可以有第二个字符串参数（可选），用于显示输出文本的类型，这样，如果应用程序的不同地方输出了类似的消息，我们就可以马上确定 `输出` 窗口中显示的是哪些输出信息。

&emsp;&emsp;这些函数的一般输出如下所示：

```javascript
        <category>: <message>
```
&emsp;&emsp;例如，下面的语句把 `MyFunc` 作为可选的类别参数：

```javascript
        Debug.WriteLine("Added1 to i", "Myfunc");
```

&emsp;&emsp;其结果为：

```javascript
        MyFunc: Added 1 to i
```

>&emsp;&emsp;下面的示例按这种方式输出调试信息。

>&emsp;&emsp;修改代码，如下所示：

```javascript
        using System;
        using System.Collections.Generic;
        using System.Diagnostics;
        using System.Linq;
        using System.Text;
        using System.Threading.Tasks;

        namespace Ch07Ex01
        {
            class Program
            {
                static void Main(string[] args)
                {
                    int[] testArray = { 4, 7, 4, 2, 7, 3, 7, 8, 3, 9, 1, 9 };
                    int[] maxValIndices;
                    int maxVal = Maxima(testArray, out maxValIndices);
                    Console.WriteLine("Maximum value {0} found at element indices:", maxVal);
                    foreach (int index in maxValIndices)
                    {
                        Console.WriteLine(index);
                    }
                    Console.ReadKey();
                }

                static int Maxima(int[] integers, out int[] indices)
                {
                    Debug.WriteLine("Maximum value search started.");
                    indices = new int[1];
                    int maxVal = integers[0];
                    indices[0] = 0;
                    int count = 1;
                    Debug.WriteLine(string.Format("Maximum value initialized to {0}, at element index 0.", maxVal));
                    for (int i = 1; i < integers.Length; i++)
                    {
                        Debug.WriteLine(string.Format("Now looking at element at index {0}", i));
                        if (integers[i] > maxVal)
                        {
                            maxVal = integers[i];
                            count = 1;
                            indices = new int[1];
                            indices[0] = i;
                            Debug.WriteLine(string.Format("New maximum found. New value is {0}, at element index {1}.", maxVal, i));
                        }
                        else
                        {
                            if (integers[i] == maxVal)
                            {
                                count ++;
                                int[] oldIndices = indices;
                                indices = new int[count];
                            }
                        }
                    }
                }
            }
        }
```



























🔚